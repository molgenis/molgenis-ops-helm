elasticsearch:
  image: "docker.elastic.co/elasticsearch/elasticsearch"
  esJavaOpts: "-Xmx2560m -Xms2560m"
  ingress:
    annotations:
      kubernetes.io/ingress.class: "nginx"
      nginx.ingress.kubernetes.io/proxy-body-size: 50m
  resources:
    requests:
      cpu: "1000m"
      memory: "3Gi"
    limits:
      cpu: "1000m"
      memory: "3Gi"
  extraEnvs:
    - name: ELASTIC_PASSWORD
      valueFrom:
        secretKeyRef:
          name: "elastic-credentials"
          key: password
    - name: ELASTIC_USERNAME
      valueFrom:
        secretKeyRef:
          name: "elastic-credentials"
          key: username
  authentication:
    username: xxxx
    password: xxxx
logstash:
  service:
    type: ClusterIP
    loadBalancerIP: ""
#    annotations:
#      kubernetes.io/ingress.class: "nginx"
#      nginx.ingress.kubernetes.io/whitelist-source-range: 195.169.22.0/23
#      nginx.ingress.kubernetes.io/proxy-body-size: 50m
    ports:
      - name: beats
        port: 55044
        protocol: TCP
        targetPort: 5044
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: "nginx"
      nginx.ingress.kubernetes.io/whitelist-source-range: 195.169.22.0/23
      nginx.ingress.kubernetes.io/proxy-body-size: 50m
    hosts:
      - host: logging.molgenis.org
        paths:
          - path: / 
            servicePort: 55044
  logstashConfig:
    logstash.yml: |
      http.host: 0.0.0.0
      xpack.monitoring.elasticsearch.hosts: ["http://elasticsearch-master:9200"]
  logstashPipeline:
    logstash.conf: |
      input {
        beats {
          port => "5044"
          ssl => false
        }
        http {
          port => 9200
          codec => json
        }
      }
      output { 
        elasticsearch {
          hosts => ["http://elasticsearch-master:9200"]
          index => "filebeat-%{[agent.version]}-%{[service.type]}-%{+xxxx.ww}"
        }
        stdout {
          codec => rubydebug
        }
      }
kibana:
  image: "docker.elastic.co/kibana/kibana"
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: "nginx"
      nginx.ingress.kubernetes.io/auth-signin: https://oauth2.molgenis.org/oauth2/start?rd=https://$host$request_uri
      nginx.ingress.kubernetes.io/auth-url: https://oauth2.molgenis.org/oauth2/auth
    path: /
  extraEnvs:
    - name: 'ELASTICSEARCH_USERNAME'
      valueFrom:
        secretKeyRef:
          name: "elastic-credentials"
          key: username
    - name: 'ELASTICSEARCH_PASSWORD'
      valueFrom:
        secretKeyRef:
          name: "elastic-credentials"
          key: password
  dashboards: custom
